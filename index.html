<!DOCTYPE html>
<html>
<head>
  <title>Typing Speed Test</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
    }
    #test-container {
      margin: 20px auto;
      padding: 20px;
      border: 1px solid #ccc;
      width: 500px;
    }
    #test-text {
      font-size: 18px;
      white-space: pre-wrap;
    }
    #input-box {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    #results {
      margin-top: 20px;
    }
    #start-button, #end-button {
      padding: 10px 20px;
      margin: 5px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #start-button {
      background-color: #4CAF50;
      color: white;
    }
    #end-button {
      background-color: #f44336;
      color: white;
    }
    #difficulty-select {
      margin-top: 10px;
    }
    #timer {
      font-size: 24px;
      margin-bottom: 10px;
    }
    .correct {
      color: green;
    }
    .incorrect {
      color: red;
    }
  </style>
</head>
<body>
  <div id="test-container">
    <h1>Typing Speed Test</h1>
    <p id="timer">Time: 00:00</p>
    <p id="test-text">The quick brown fox jumps over the lazy dog.</p>
    <input type="text" id="input-box" disabled>
    <button id="start-button">Start</button>
    <button id="end-button" disabled>End</button>
    <div id="results">
      <p>WPM: <span id="wpm">0</span></p>
      <p>Accuracy: <span id="accuracy">0%</span></p>
      <p>Best WPM: <span id="best-wpm">0</span></p>
      <p>Best Accuracy: <span id="best-accuracy">0%</span></p>
    </div>
    <div id="difficulty-select">
      <label for="difficulty">Difficulty:</label>
      <select id="difficulty">
        <option value="easy">Easy</option>
        <option value="medium">Medium</option>
        <option value="hard">Hard</option>
      </select>
    </div>
  </div>

  <script>
    const testTextElement = document.getElementById('test-text');
    const inputBox = document.getElementById('input-box');
    const startButton = document.getElementById('start-button');
    const endButton = document.getElementById('end-button');
    const wpmDisplay = document.getElementById('wpm');
    const accuracyDisplay = document.getElementById('accuracy');
    const difficultySelect = document.getElementById('difficulty');
    const timerDisplay = document.getElementById('timer');
    const bestWpmDisplay = document.getElementById('best-wpm');
    const bestAccuracyDisplay = document.getElementById('best-accuracy');

    let startTime, endTime;
    let typedText = '';
    let testText = ''; 
    let timerInterval;
    let bestWpm = 0;
    let bestAccuracy = 0;

    if (localStorage.getItem('bestWpm')) {
      bestWpm = parseInt(localStorage.getItem('bestWpm'));
      bestWpmDisplay.textContent = bestWpm;
    }
    if (localStorage.getItem('bestAccuracy')) {
      bestAccuracy = parseInt(localStorage.getItem('bestAccuracy'));
      bestAccuracyDisplay.textContent = bestAccuracy;
    }

    function setTestText(difficulty) {
      const easySamples = [
        'The quick brown fox jumps over the lazy dog.',
        'A fast black cat dashes under the quiet moon.',
        'Every good boy does fine.',
        'Jump high, run fast, and play fair.'
      ];

      const mediumSamples = [
        'Typing speed is a skill that can be developed with consistent practice.',
        'Programming languages like JavaScript, Python, and C++ are popular among developers.',
        'The Eiffel Tower in Paris is one of the most iconic landmarks in the world.',
        'Learning new skills can be both challenging and rewarding.'
      ];

      const hardSamples = [
        'As technology advances, artificial intelligence continues to evolve at an unprecedented rate, creating both opportunities and ethical dilemmas that society must address.',
        'Quantum computing leverages the principles of quantum mechanics to process information in fundamentally different ways compared to classical computers, opening up new possibilities in cryptography and complex problem-solving.',
        'The theory of relativity, developed by Albert Einstein, revolutionized the understanding of space, time, and gravity, challenging long-held beliefs and laying the groundwork for modern physics.',
        'In the context of environmental sustainability, adopting renewable energy sources such as solar, wind, and hydropower is crucial to mitigating the impact of climate change and ensuring a cleaner, more sustainable future for generations to come.'
      ];

      switch (difficulty) {
        case 'easy':
          testText = easySamples[Math.floor(Math.random() * easySamples.length)];
          break;
        case 'medium':
          testText = mediumSamples[Math.floor(Math.random() * mediumSamples.length)];
          break;
        case 'hard':
          testText = hardSamples[Math.floor(Math.random() * hardSamples.length)];
          break;
      }
      testTextElement.innerHTML = testText.split('').map(letter => `<span>${letter}</span>`).join('');
    }

    startButton.addEventListener('click', () => {
      startTime = new Date();
      inputBox.disabled = false;
      inputBox.value = ''; // Clear the input box
      inputBox.focus();
      startButton.disabled = true;
      endButton.disabled = false;
      timerInterval = setInterval(updateTimer, 1000);
    });

    endButton.addEventListener('click', () => {
      endTime = new Date();
      clearInterval(timerInterval);
      calculateResults();
      inputBox.disabled = true;
      startButton.disabled = false;
      endButton.disabled = true;
      timerDisplay.textContent = 'Time: 00:00';
    });

    inputBox.addEventListener('input', () => {
      typedText = inputBox.value;
      const spans = testTextElement.querySelectorAll('span');
      for (let i = 0; i < spans.length; i++) {
        if (typedText[i] === undefined) {
          spans[i].classList.remove('correct', 'incorrect');
        } else if (typedText[i] === spans[i].textContent) {
          spans[i].classList.add('correct');
          spans[i].classList.remove('incorrect');
        } else {
          spans[i].classList.add('incorrect');
          spans[i].classList.remove('correct');
        }
      }

      if (typedText === testText) {
        endTime = new Date();
        clearInterval(timerInterval);
        calculateResults();
        inputBox.disabled = true;
        startButton.disabled = false;
        endButton.disabled = true;
        timerDisplay.textContent = 'Time: 00:00';
      }
    });

    difficultySelect.addEventListener('change', () => {
      setTestText(difficultySelect.value);
    });

    function calculateResults() {
      const timeTaken = (endTime - startTime) / 1000; 
      const words = testText.trim().split(/\s+/).length; 
      const wpm = Math.round((words / timeTaken) * 60);
      const accuracy = Math.round((typedText.length - getErrors(testText, typedText)) / testText.length * 100);
      wpmDisplay.textContent = wpm;
      accuracyDisplay.textContent = accuracy + '%';

      if (wpm > bestWpm) {
        bestWpm = wpm;
        bestWpmDisplay.textContent = bestWpm;
        localStorage.setItem('bestWpm', bestWpm);
      }
      if (accuracy > bestAccuracy) {
        bestAccuracy = accuracy;
        bestAccuracyDisplay.textContent = bestAccuracy;
        localStorage.setItem('bestAccuracy', bestAccuracy);
      }
    }

    function getErrors(correctText, typedText) {
      let errors = 0;
      for (let i = 0; i < Math.min(correctText.length, typedText.length); i++) {
        if (correctText[i] !== typedText[i]) {
          errors++;
        }
      }
      return errors;
    }

    function updateTimer() {
      const timeElapsed = new Date() - startTime;
      const minutes = Math.floor(timeElapsed / 60000);
      const seconds = Math.floor((timeElapsed % 60000) / 1000);
      timerDisplay.textContent = `Time: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    setTestText('easy');
  </script>
</body>
</html>
