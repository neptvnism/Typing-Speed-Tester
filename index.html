<!DOCTYPE html>
<html>
<head>
  <title>Typing Speed Test</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
    }
    #test-container {
      margin: 20px auto;
      padding: 20px;
      border: 1px solid #ccc;
      width: 500px;
    }
    #test-text {
      font-size: 18px;
      white-space: pre-wrap; /* Preserve line breaks */
    }
    #input-box {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    #results {
      margin-top: 20px;
    }
    #start-button, #end-button {
      padding: 10px 20px;
      margin: 5px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #start-button {
      background-color: #4CAF50;
      color: white;
    }
    #end-button {
      background-color: #f44336; /* Red */
      color: white;
    }
    #difficulty-select {
      margin-top: 10px;
    }
    #timer {
      font-size: 24px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div id="test-container">
    <h1>Typing Speed Test</h1>
    <p id="timer">Time: 00:00</p>
    <p id="test-text">The quick brown fox jumps over the lazy dog.</p>
    <input type="text" id="input-box" disabled>
    <button id="start-button">Start</button>
    <button id="end-button" disabled>End</button>
    <div id="results">
      <p>WPM: <span id="wpm">0</span></p>
      <p>Accuracy: <span id="accuracy">0%</span></p>
      <p>Best WPM: <span id="best-wpm">0</span></p>
      <p>Best Accuracy: <span id="best-accuracy">0%</span></p>
    </div>
    <div id="difficulty-select">
      <label for="difficulty">Difficulty:</label>
      <select id="difficulty">
        <option value="easy">Easy</option>
        <option value="medium">Medium</option>
        <option value="hard">Hard</option>
      </select>
    </div>
  </div>

  <script>
    const testTextElement = document.getElementById('test-text');
    const inputBox = document.getElementById('input-box');
    const startButton = document.getElementById('start-button');
    const endButton = document.getElementById('end-button');
    const wpmDisplay = document.getElementById('wpm');
    const accuracyDisplay = document.getElementById('accuracy');
    const difficultySelect = document.getElementById('difficulty');
    const timerDisplay = document.getElementById('timer');
    const bestWpmDisplay = document.getElementById('best-wpm');
    const bestAccuracyDisplay = document.getElementById('best-accuracy');

    let startTime, endTime;
    let typedText = '';
    let testText = ''; // Store the actual test text
    let timerInterval;
    let bestWpm = 0;
    let bestAccuracy = 0;

    // Load best scores from local storage
    if (localStorage.getItem('bestWpm')) {
      bestWpm = parseInt(localStorage.getItem('bestWpm'));
      bestWpmDisplay.textContent = bestWpm;
    }
    if (localStorage.getItem('bestAccuracy')) {
      bestAccuracy = parseInt(localStorage.getItem('bestAccuracy'));
      bestAccuracyDisplay.textContent = bestAccuracy;
    }

    function setTestText(difficulty) {
      switch (difficulty) {
        case 'easy':
          testText = 'The quick brown fox jumps over the lazy dog.';
          break;
        case 'medium':
          testText = 'The quick brown fox jumps over the lazy dog. The quick brown fox jumps over the lazy dog.';
          break;
        case 'hard':
          testText = 'The quick brown fox jumps over the lazy dog. The quick brown fox jumps over the lazy dog. The quick brown fox jumps over the lazy dog. The quick brown fox jumps over the lazy dog.';
          break;
      }
      testTextElement.textContent = testText;
    }

    startButton.addEventListener('click', () => {
      startTime = new Date();
      inputBox.disabled = false;
      inputBox.focus();
      startButton.disabled = true;
      endButton.disabled = false;
      timerInterval = setInterval(updateTimer, 1000);
    });

    endButton.addEventListener('click', () => {
      endTime = new Date();
      clearInterval(timerInterval);
      calculateResults();
      inputBox.disabled = true;
      startButton.disabled = false;
      endButton.disabled = true;
      timerDisplay.textContent = 'Time: 00:00';
    });

    inputBox.addEventListener('input', () => {
      typedText = inputBox.value;
      if (typedText === testText) {
        endTime = new Date();
        clearInterval(timerInterval);
        calculateResults();
        inputBox.disabled = true;
        startButton.disabled = false;
        endButton.disabled = true;
        timerDisplay.textContent = 'Time: 00:00';
      }
    });

    difficultySelect.addEventListener('change', () => {
      setTestText(difficultySelect.value);
    });

    function calculateResults() {
      const timeTaken = (endTime - startTime) / 1000; // in seconds
      const words = testText.trim().split(/\s+/).length; // Trim and split by spaces
      const wpm = Math.round((words / timeTaken) * 60);
      const accuracy = Math.round((typedText.length - getErrors(testText, typedText)) / testText.length * 100);
      wpmDisplay.textContent = wpm;
      accuracyDisplay.textContent = accuracy + '%';

      // Update best scores
      if (wpm > bestWpm) {
        bestWpm = wpm;
        bestWpmDisplay.textContent = bestWpm;
        localStorage.setItem('bestWpm', bestWpm);
      }
      if (accuracy > bestAccuracy) {
        bestAccuracy = accuracy;
        bestAccuracyDisplay.textContent = bestAccuracy;
        localStorage.setItem('bestAccuracy', bestAccuracy);
      }
    }

    function getErrors(correctText, typedText) {
      let errors = 0;
      for (let i = 0; i < Math.min(correctText.length, typedText.length); i++) {
        if (correctText[i] !== typedText[i]) {
          errors++;
        }
      }
      return errors;
    }

    function updateTimer() {
      const timeElapsed = new Date() - startTime;
      const minutes = Math.floor(timeElapsed / 60000);
      const seconds = Math.floor((timeElapsed % 60000) / 1000);
      timerDisplay.textContent = `Time: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    // Initial setup: Set easy difficulty by default
    setTestText('easy');
  </script>
</body>
</html>
